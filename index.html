<html>
    <head>
        <title>Nanotronics | Daily Inspiration</title>
        <link href="css/flapper.css" type="text/css" rel="stylesheet" />
        <script src="libs/jquery/1.8.2/jquery.min.js"></script>
        <script src="transform/dist/jquery.transform-0.9.3.min.js"></script>
        <script src="src/jquery.flapper.js"></script>
        <script src="src/flapdemo.js"></script>
        <style type="text/css">
            body {
                font-family: "Neue Montreal", "Helvetica Neue", Arial, sans-serif;
                color: #333;
                background-color: #fff;
            }

            .page {
                width: 1200px;
                margin: 50px auto 0;
            }

            h1 {
                text-align: center;
                font-size: 24px;
            }

            .displays {
                padding: 80px;
                background-color: #000;
                border-radius: 0px;
                box-shadow: 0 0 12px 4px #000 inset;
            }

            .flapper {
                margin-bottom: 2px;
                text-align: center;
            }

            .inputarea {
                display: none; /* Hide input area */
            }

            #quote {
                font-family: sans-serif;
                font-size: 1.2em;
                text-align: center;
                margin-bottom: 10px;
                color: #000;
            }

            #author {
                font-family: sans-serif;
                font-size: 1.2em;
                color: #000;
                text-align: center;
            }

            #thanks {
                max-width: 600px;
                height: 480px;
                margin: 0 auto;
                align-content: center;
            }

            #thanks p {
                font-family: "PP Neue Montreal", "Helvetica Neue", Arial, sans-serif;
                font-size: 18px;
                line-height: 27px;
                color: #00000099;
                text-align: justify;
/*                padding-top: 18px;
                border-top: 1px solid #00000044;                
*/            }

            a {
                color: #00000066;
                text-decoration: none;
            }

            a:hover {
                color: #000000AA;
                text-decoration: underline;
            }

            #nano_sticker {
                display: block;
                margin: auto;
                width: 50px;
                height: 50px;
            }

            footer {
                font-family: "PP Neue Montreal", "Helvetica Neue", Arial, sans-serif;
                font-size: 14px;
                line-height: 20px;
                color: #00000099;
                text-align: center;
                padding: 30px;
            }

            div.inline {
                display: inline-block;
                vertical-align: bottom;
            }

            div.activity {
                width: 12px;
                height: 12px;
                border-radius: 6px;
                background-color: #250000;
                position: relative;
                top: 33px;
                left: -15px;
            }

            div.activity.active {
                background-color: #ED1C24;
            }

            ::selection {
                color: #fff;
                background: #ED1C24;
            }

            .timer-container {
              width: 100%; /* Full width of the line */
              height: 1px; /* Height of the line */
              background-color: #00000011; /* Gray line background */
              overflow: hidden; /* Ensure the black line stays within bounds */
              position: relative;
            }

            .timer-line {
              width: 100%; /* Initially full width */
              height: 100%; /* Match the container height */
              background-color: #00000033; /* Black line color */
              position: absolute;
              top: 0;
              left: 0;
              animation: shrink 30s linear infinite; /* Shrink every 30 seconds */
            }

            @keyframes shrink {
              0% {
                width: 100%; /* Start with full width */
              }
              100% {
                width: 0; /* Shrink to 0 width */
              }
            }
        </style>
    </head>
    <body>
        <div class="page">
            <!-- <h1>FLAPPER DEMO</h1> -->
            <div class="displays">
                <div class="activity"></div><input class="display M" />
                <div class="activity"></div><input class="display M" />
                <div class="activity"></div><input class="display M" />
                <div class="activity"></div><input class="display M" />
                <div class="activity"></div><input class="display M" />
                <div class="activity"></div><input class="display M" />
            </div>
            <div id="thanks">
            <div class="timer-container">
                <div class="timer-line"></div>
            </div>
                <p>At <a href="https://nanotronics.ai">Nanotronics</a>, I begin each morning entering <a href="https://nanotronics.ai/overview">Building 20</a>, where I&#8217;m greeted by a mechanical display board, reminiscent of one found in an old train station. This digital display board is populated with quotes that have been shared with the Nanotronics family since I joined the company in 2023. These quotes were selected by Paul Henrique, Security Manager for Building 20. I hope these quotes provide inspiration for you, just like they have for me&#8212;day in, day out.<br><br>&#8211; Jonathan Bobrow, UX/UI Designer</p>

                <svg id="nano_sticker" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 144.35 143.28">
                  <defs>
                    <style>
                      .cls-1 {
                        fill: #ed1c24;
                      }

                      .cls-2 {
                        fill: #fff;
                      }
                    </style>
                  </defs>
                  <circle class="cls-2" cx="71.68" cy="72.28" r="63"/>
                  <path class="cls-1" d="M104.35,99.78h-16.53l-15.65-27.83-31.73,45.58V47.22h17.82l13.91,24.73,32.18-46.2v74.03ZM72.18,0C32.31,0,0,32.08,0,71.64s32.31,71.64,72.18,71.64,72.17-32.08,72.17-71.64S112.04,0,72.18,0"/>
                </svg>
            </div>
            <footer>
                Special thanks to <a href="https://jaykayess.com/Flapper/">Flapper</a> and <a href="https://jaykayess.com/">Justin Kerr Sheckler</a></footer>
            </footer>
        </div>
        <script>
            let flapDemo;

            async function fetchQuotes() {
                try {
                    const response = await fetch('quotes.csv');
                    const csvText = await response.text();
                    return parseCSV(csvText);
                } catch (error) {
                    console.error('Failed to fetch quotes:', error);
                    return [];
                }
            }

            function parseCSV(csvText) {
                const rows = csvText.split('\n').slice(1); // Skip header row
                return rows
                    .map(row => {
                        // Match CSV fields, including those enclosed in double quotes
                        const columns = row.match(/(?:[^,""]+|"[^"]*")+/g);
                        if (!columns || columns.length < 3) return null; // Ensure there are at least 3 columns

                        // Remove surrounding quotes from fields and trim whitespace
                        const [date, quote, author] = columns.map(col =>
                            col.replace(/^"|"$/g, '').trim()
                        );

                        return {
                            date,
                            quote,
                            author,
                        };
                    })
                    .filter(row => 
                        row && 
                        row.quote && 
                        row.author && 
                        row.quote.length <= 100 // Filter out long quotes
                    ); // Remove empty, invalid, or overly long quotes
            }

            function formatQuoteForDisplay(quote, author, wrap, numLines) {
                const quoteText = `${quote}`;
                const buffer = new FlapBuffer(wrap, numLines);
                const words = quote.split(/\s+/);
                const authorName = `${author}`;
                const authorNameWords = authorName.split(/\s+/);

                // add quote
                words.forEach(word => buffer.pushWord(word));
                buffer.flush();

                // add author on the next line
                buffer.pushWord(`-`);
                authorNameWords.forEach(nameWord => buffer.pushWord(nameWord));
                buffer.flush();

                // console.log('Formatted buffers:', buffer.buffers);

                return buffer.buffers;
            }

            function displayQuote(quotes) {
                if (quotes.length === 0) {
                    flapDemo.updateDisplay([['No quotes available.']]);
                    return;
                }

                const randomIndex = Math.floor(Math.random() * quotes.length);
                const { quote, author } = quotes[randomIndex];

                const formattedBuffers = formatQuoteForDisplay(quote, author, 22, 6); // Adjust width and line count
                flapDemo.updateDisplay(formattedBuffers);
            }

            async function init() {
                flapDemo = new FlapDemo('input.display', '#typesomething', '#showme');
                const quotes = await fetchQuotes();
                if (quotes.length > 0) {
                    displayQuote(quotes);
                    setInterval(() => displayQuote(quotes), 30000); // Update every 30 seconds
                }
            }

            init();
        </script>
    </body>
</html>