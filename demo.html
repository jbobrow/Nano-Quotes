<html>
    <head>
        <title>FLAPPER DEMO</title>
        <link href="css/flapper.css" type="text/css" rel="stylesheet" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script src="transform/dist/jquery.transform-0.9.3.min.js"></script>
        <script src="src/jquery.flapper.js"></script>
        <script src="src/flapdemo.js"></script>
        <style type="text/css">
            body {
                font-family: Roboto Condensed;
                color: #333;
            }

            .page {
                width: 1000px;
                margin: 30px auto 0;
            }

            h1 {
                text-align: center;
                font-size: 24px;
            }

            .displays {
                padding: 30px;
                border: 10px solid #ccc;
                background-color: #222;
                border-radius: 30px;
                box-shadow: 0 0 12px 4px #000 inset;
            }

            .flapper {
                margin-bottom: 2px;
                text-align: center;
            }

            .inputarea {
                display: none; /* Hide input area */
            }

            #quote {
                font-size: 1.8em;
                font-weight: bold;
                text-align: center;
                margin-bottom: 10px;
                color: #fff;
            }

            #author {
                font-size: 1.2em;
                color: gray;
                text-align: center;
            }

            div.inline {
                display: inline-block;
                vertical-align: bottom;
            }

            div.activity {
                width: 12px;
                height: 12px;
                border-radius: 6px;
                background-color: #250000;
                position: relative;
                top: 33px;
                left: -15px;
            }

            div.activity.active {
                background-color: #f00;
            }

            #fork-me {
                display: none;
                width: 180px;
                height: 150px;
                position: absolute;
                top: 0px;
                right: 0px;
                overflow: hidden;
            }

            #fork-me a {
                display: block;
                position: absolute;
                top: 35px;
                right: -75px;
                padding: 0.75em 4em;
                background: #881c15;
                -webkit-transform: rotate(40deg);
                -moz-transform: rotate(40deg);
                -o-transform: rotate(40deg);
                -ms-transform: rotate(40deg);
                color: white !important;
                font-weight: bold;
                font-family: helvetica;
                text-decoration: none;
                border: 1px solid white;
                box-shadow: 0 0 10px black;
                text-shadow: 0 0 10px black;
                white-space: nowrap;
            }
        </style>
    </head>
    <body>
        <div class="page">
            <!-- <h1>FLAPPER DEMO</h1> -->
            <div id="quote">Loading quote...</div>
            <div id="author"></div>
            <div class="displays">
                <div class="activity"></div><input class="display M" />
                <div class="activity"></div><input class="display M" />
                <div class="activity"></div><input class="display M" />
                <div class="activity"></div><input class="display M" />
                <div class="activity"></div><input class="display M" />
                <div class="activity"></div><input class="display M" />
            </div>
            <div class="inputarea">
                <div class="inline"><textarea id="typesomething" placeholder="Type Something Here..." rows="6" cols="20"></textarea></div>
                <div class="inline"><button id="showme">And Click Here</button></div>
            </div>
        </div>
        <div id="fork-me">
            <a href="https://github.com/jayKayEss/Flapper">Fork me on GitHub</a>
        </div>
        <script>
            async function fetchQuotes() {
                try {
                    const response = await fetch('quotes.csv');
                    const csvText = await response.text();
                    return parseCSV(csvText);
                } catch (error) {
                    console.error('Failed to fetch quotes:', error);
                    return [];
                }
            }

            function parseCSV(csvText) {
                const rows = csvText.split('\n').slice(1); // Skip header row
                return rows
                    .map(row => {
                        const columns = row.split(',');
                        if (columns.length < 3) return null; // Ensure there are at least 3 columns
                        const [date, quote, author] = columns;
                        return {
                            date: date?.trim(),
                            quote: quote?.trim(),
                            author: author?.trim(),
                        };
                    })
                    .filter(row => row && row.quote && row.author); // Remove empty or invalid rows
            }

            function displayQuote(quotes) {
                if (quotes.length === 0) {
                    document.getElementById('quote').textContent = 'No quotes available.';
                    document.getElementById('author').textContent = '';
                    return;
                }

                const randomIndex = Math.floor(Math.random() * quotes.length);
                const { quote, author } = quotes[randomIndex];

                document.getElementById('quote').textContent = quote;
                document.getElementById('author').textContent = `- ${author}`;
            }

            async function init() {
                const quotes = await fetchQuotes();
                if (quotes.length > 0) {
                    displayQuote(quotes);
                    setInterval(() => displayQuote(quotes), 10000); // Update every 10 seconds
                }
            }

            init();
        </script>
    </body>
</html>